# 学习材料：

https://pytorch123.com/
PyTorch官方教程

--------------------------------------------------------

# 部署流程：

ubuntu(我是在ubuntu 18.04/ 笔记本用osx上部署）或者其他linux，或者osx等类unix系统
其他系统没有经过充分测试




方案1:使用python3+pip3部署方案，步骤1～4如下：

1.
安装python3.6 以上版本

2. 
安装pip3 

3.
（可选，非必须）（创建python3虚拟目录，隔绝不同版本库之间相互影响）
https://docs.python.org/zh-cn/3/tutorial/venv.html


4.
terminal底下进入工程目录下，在requirements.txt同级目录下运行：
pip3 install --upgrade -r requirements.txt



5.（可选，非必须）
启动1个命令行窗口，在terminal分别按顺序执行下面不同的命令
（头4个可以开4个窗口同时执行，也可以挨个按顺序执行，甚至可以不执行，因为我已经执行过了，缓存了中间结果）
python3 i2main.py -c  utils/conf_centralized1_1.json

python3 i2main.py -c  utils/conf_centralized1_2.json

python3 i2main.py -c  utils/conf_centralized1_3.json

python3 i2main.py -c  utils/conf_f5.json

python3 i2main.py -c  utils/conf_f10.json

6.
python3 i3experiment_drawing.py
获得联邦学习各种配置server-client模式下不同的准确率和loss参数



7.
命令行下启动网站服务，在命令行下执行:
python3 i4wsgi.py



8.
浏览器访问：

http://localhost:5000/home

已经注册好的管理员账号 可以直接登录：
管理员1
username: greatabel1@126.com 
password: abel
你也可以自己注册和登录

管理员2
username: admin@126.com
password: admin

-------------------
一般用户测试账号:
username:test@126.com   
password: test

9.
个人主页： http://localhost:5000/profile

10.
（可选）
可以根据需要补充下载一些图数据，然后自己调选和过滤进入训练/测试数据集
python3 i0down_training_resource.py


# ----------------------------------

方案2:如果使用anaconda方案，可以跳过步骤1～4，直接：
安装[Python](https://www.anaconda.com/products/individual)、
[Pytorch](https://pytorch.org/get-started/locally/)环境



# ----------- 论文素材 -------------

技术方案：
们的方案重点是：联邦学习（特别是多client 和server通信）、机器学习 【整体是pytorch+ tensorflow+numpy+pandas+(lask+vue+boostrap)】
1.
联邦学习
我想到一个类似 这个哈尔冰论文的法子：可以这样做吗，我去做根据图片集（sunny/clound）图片集的残差网络分类，然后用联邦学习和集中学习训练它，比较它。    这个可以分配到我模拟的多进程多线程客户端节点，在本地联邦学习多节点进行训练，然后把参数进行综合
1.1 我去搜索引擎采集图片（suny的还有对照clound），然后进行数据探索和分析，以决定使用的模型

1.2 把整理的数据集，将数据集分成3份，视为3个不同的所有者ABC，每份都包括训练集和测试集。将每个所有者作为客户端节点，
  另外设置一个服务器（本机是进程/线程实现的）用于联邦学习模型融合以及调度。

1.3 模型在服务器端将初始化的数据发送给各个客户端节点，客户端节点在本地对模型进行一个epoch的训练，并将参数返回服务器端。
  服务器端收到所有客户端发来的参数后，将所有参数融合。然后不断循环上述步骤，直到结果收敛。
1.4 最后将该结果与进行集中式深度学习训练的结果进行对比，方便网站上展示我们联邦学习的效果。（我打算是通过不同配置配置文件 实现不同的训练方案，会设计至少3-4套），
    机器学习训练的结果acc/loss 我会训练同期缓存成py 缓存对象，和flask根据缓存进行通讯。
    （如果数据一样的情况下，联邦学习是没法子超过集中式学习的，我们得突出联邦学习解决隐私问题，更多所有者愿意贡献出数据，我们数据上会单client节点少于集中式机器学习，
    但是所有联邦学习节点加起来超过集中式）

2.
   flask结果展示和交互：
   基于flask+vue+bootstrap设计网站注册/登录/主页，然后根据上面1步选择不同的联邦学习配置方案（预先选择的1.4的几套配置方案），
   展示不同的方案的训练迭代过程图（读出acc/loss 的变化过程）

3.这样可以预测的是你上传当前的天空拍照/或者前一天的天空拍照，然后我根据我们的模型预测天气的未来情况是sunny还是cloudy
这块因为模型都是通过数据集验证的，因为联邦学习需要魔改，估计不太好向普通的模型那样保存和使用，看看去掉这个功能不。
如果不去掉的话，我就使用tensorflow另外实现调用一个训练好的模型做预测。


联邦学习架构：

横向联邦学习的服务端的主要功能是将被选择的客户端上传的本地模型进行模型聚合。但这里需要特别注意的是，
事实上，对于一个功能完善的联邦学习框架，比如我们将在后面介绍的FATE平台，服务端的功能要复杂得多，比如服务端需要对各个客户端节点进行网络监控、
对失败节点发出重连信号等。由于是在本地模拟的，不涉及网络通信细节和失败故障等处理，因此不讨论这些功能细节，仅涉及模型聚合功能。

我们首先定义一个服务端类Server，类中的主要函数包括以下几个。
定义构造函数。在构造函数中，服务端的工作包括：第一，将配置信息拷贝到服务端中；第二，按照配置中的模型信息获取模型，
这里我们使用torchvision 的models模块内置的ResNet模型.

横向联邦学习的客户端主要功能是接收服务端的下发指令和全局模型，利用本地数据进行局部模型训练。与前一节一样，
对于一个功能完善的联邦学习框架，客户端的功能同样相当复杂，比如需要考虑本地的资源（CPU、内存等）是否满足训练需要、当前的网络中断、当前的训练由于受到外界因素影响而中断等。读者如果对这些设计细节感兴趣，可以查看当前流行的联邦学习框架源代码和文档，比如FATE，获取更多的实现细节。
我们仅考虑客户端本地的模型训练细节。我们首先定义客户端类Client，类中的主要函数包括以下两种。

- 定义构造函数。在客户端构造函数中，客户端的主要工作包括：首先，将配置信息拷贝到客户端中；然后，按照配置中的模型信息获取模型，
通常由服务端将模型参数传递给客户端，客户端将该全局模型覆盖掉本地模型；最后，配置本地训练数据，在本天气预测分类中，
我们通过自己整理的素材，然后手工挑选，修正数据后，组成datasets 模块获取c
数据集后按客户端ID切分，不同的客户端拥有不同的子数据集，相互之间没有交集



